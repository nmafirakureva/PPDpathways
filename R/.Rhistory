axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none"
)
GP
fn1 <- glue(here('plots/ATT_cascadeTBD_lables')) + '.png'
ggsave(GP,file=fn1,w=6,h=5);
fn1 <- glue(here('plots/ATT_cascadeTBD_labels')) + '.png'
ggsave(GP,file=fn1,w=6,h=5);
# Create the Cascade Plot
GP <- ggplot(att_cascade, aes(x = Stages, y = Cascade, fill = Stages)) +
geom_bar(stat = "identity", width = 0.6, color = "black") +
geom_text(aes(label = scales::percent(Cascade, accuracy = 0.1)), vjust = -0.5, size = 3) +
facet_wrap(~ assumption) +
# Add arrows to indicate transition between stages
geom_segment(aes(
x = x_start,
xend = x_end,
y = Midpoint-0.05,
yend = Midpoint-0.05),
arrow = arrow(length = unit(0.2, "cm"), type = "closed"),
color = "red") +
# Add descriptive labels showing the proportion applied
geom_text(aes(
x = as.numeric(Stages) - 0.5,
y = Midpoint,
label = Transition_Label),
color = "blue",
vjust = 1.2,
size = 3) +
scale_fill_brewer(palette = "Set3") +
labs(
title = "ATT Cascade",
x = "Stages",
y = "Proportion"
) +
# theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none"
)
GP
fn1 <- glue(here('plots/ATT_cascadeTBD_labels')) + '.png'
ggsave(GP,file=fn1,w=6,h=5);
ggsave(GP,file=fn1,w=8,h=5);
ggsave(GP,file=fn1,w=10,h=5);
# Create the Cascade Plot
GP <- ggplot(att_cascade, aes(x = Stages, y = Cascade, fill = Stages)) +
geom_bar(stat = "identity", width = 0.6, color = "black") +
geom_text(aes(label = scales::percent(Cascade, accuracy = 0.1)), vjust = -0.5, size = 2) +
facet_wrap(~ assumption) +
# Add arrows to indicate transition between stages
geom_segment(aes(
x = x_start,
xend = x_end,
y = Midpoint-0.05,
yend = Midpoint-0.05),
arrow = arrow(length = unit(0.2, "cm"), type = "closed"),
color = "red") +
# Add descriptive labels showing the proportion applied
geom_text(aes(
x = as.numeric(Stages) - 0.5,
y = Midpoint,
label = Transition_Label),
color = "blue",
vjust = 1.2,
size = 3) +
scale_fill_brewer(palette = "Set3") +
labs(
title = "ATT Cascade",
x = "Stages",
y = "Proportion"
) +
# theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none"
)
GP
# Create the Cascade Plot
GP <- ggplot(att_cascade, aes(x = Stages, y = Cascade, fill = Stages)) +
geom_bar(stat = "identity", width = 0.6, color = "black") +
geom_text(aes(label = scales::percent(Cascade, accuracy = 0.1)), vjust = -0.5, size = 2.5) +
facet_wrap(~ assumption) +
# Add arrows to indicate transition between stages
geom_segment(aes(
x = x_start,
xend = x_end,
y = Midpoint-0.05,
yend = Midpoint-0.05),
arrow = arrow(length = unit(0.2, "cm"), type = "closed"),
color = "red") +
# Add descriptive labels showing the proportion applied
geom_text(aes(
x = as.numeric(Stages) - 0.5,
y = Midpoint,
label = Transition_Label),
color = "blue",
vjust = 1.2,
size = 2.5) +
scale_fill_brewer(palette = "Set3") +
labs(
title = "ATT Cascade",
x = "Stages",
y = "Proportion"
) +
# theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none"
)
GP
0.1+0.05
# Create the Cascade Plot
GP <- ggplot(att_cascade, aes(x = Stages, y = Cascade, fill = Stages)) +
geom_bar(stat = "identity", width = 0.6, color = "black") +
geom_text(aes(label = scales::percent(Cascade, accuracy = 0.1)), vjust = -0.5, size = 2.5) +
facet_wrap(~ assumption) +
# Add arrows to indicate transition between stages
geom_segment(aes(
x = x_start,
xend = x_end,
y = Midpoint-0.15,
yend = Midpoint-0.15),
arrow = arrow(length = unit(0.2, "cm"), type = "closed"),
color = "red") +
# Add descriptive labels showing the proportion applied
geom_text(aes(
x = as.numeric(Stages) - 0.5,
y = Midpoint-0.1,
label = Transition_Label),
color = "blue",
vjust = 1.2,
size = 2.5) +
scale_fill_brewer(palette = "Set3") +
labs(
title = "ATT Cascade",
x = "Stages",
y = "Proportion"
) +
# theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none"
)
GP
fn1 <- glue(here('plots/ATT_cascadeTBD_labels')) + '.png'
ggsave(GP,file=fn1,w=10,h=5);
# TPT
# TPT
tpt_levels <- c('prop.tb.sympt.screen', 'prop.igra.tested', 'prop.igra.test.positive', 'prop.staying.o3.months',
'prop.attend.nhs.referral', 'prop.starting.tpt', 'prop.completing.tpt')
tpt_labels <- c('tb.sympt.screen', 'igra.tested', 'igra.test.positive', 'staying.o3.months',
'attend.nhs.referral', 'starting.tpt', 'completing.tpt')
tpt_cascade <- tpt_cascade |>
mutate(Stages = factor(Stage, levels = paste0('int.', tpt_levels), labels = tpt_labels, ordered = TRUE)) |>
filter(tb=='TBI')
GP <- ggplot(tpt_cascade, aes(x = Stages, y = Cascade, fill = Stages)) +
geom_bar(stat = "identity", width = 0.6, color = "black") +
geom_text(aes(label = scales::percent(Cascade, accuracy = 0.1)), vjust = -0.5, size = 3) +
facet_wrap(~ assumption) +
scale_fill_brewer(palette = "Set3") +
labs(title = "TPT cascadeTBI",
x = "Stages",
y = "Proportion") +
# theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none")
GP
tpt_cascade
tpt_cascade
# TPT
tpt_levels <- c('prop.tb.sympt.screen', 'prop.igra.tested', 'prop.igra.test.positive', 'prop.staying.o3.months',
'prop.attend.nhs.referral', 'prop.starting.tpt', 'prop.completing.tpt')
tpt_labels <- c('tb.sympt.screening', 'igra.tested', 'igra.test.positive', 'staying.o3.months',
'attend.nhs.referral', 'starting.tpt', 'completing.tpt')
tpt_cascade <- tpt_cascade |>
mutate(Stages = factor(Stage, levels = paste0('int.', tpt_levels), labels = tpt_labels, ordered = TRUE)) |>
filter(tb=='TBI')
GP <- ggplot(tpt_cascade, aes(x = Stages, y = Cascade, fill = Stages)) +
geom_bar(stat = "identity", width = 0.6, color = "black") +
geom_text(aes(label = scales::percent(Cascade, accuracy = 0.1)), vjust = -0.5, size = 3) +
facet_wrap(~ assumption) +
scale_fill_brewer(palette = "Set3") +
labs(title = "TPT cascadeTBI",
x = "Stages",
y = "Proportion") +
# theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none")
GP
fn1 <- glue(here('plots/TPT_cascade')) + SA + '.png'
# Assuming tpt_cascade has columns: 'Stages', 'Cascade', and 'assumption'
# Calculate the detailed labels for each stage
tpt_cascade <- tpt_cascade %>%
arrange(Stages) %>%
group_by(assumption) %>%
mutate(
# Create transition labels showing the proportion applied at each stage
Transition_Label = scales::percent(Cascade / lag(Cascade, default = first(Cascade)), accuracy = 1),
x_start = as.numeric(Stages) - 0.67,  # Start of the arrow (midpoint between stages)
x_end = as.numeric(Stages) - 0.35,    # End of the arrow (midpoint to next stage)
Midpoint = (Cascade + lag(Cascade, default = first(Cascade))) / 2  # Position for the label
)|>
mutate(Transition_Label = ifelse(grepl('screening', Stages), NA, Transition_Label),
x_start = ifelse(grepl('screening', Stages), NA, x_start),
x_end = ifelse(grepl('screening', Stages), NA, x_end))
# Create the Cascade Plot
GP <- ggplot(tpt_cascade, aes(x = Stages, y = Cascade, fill = Stages)) +
geom_bar(stat = "identity", width = 0.6, color = "black") +
geom_text(aes(label = scales::percent(Cascade, accuracy = 0.1)), vjust = -0.5, size = 3) +
facet_wrap(~ assumption) +
# Add arrows to indicate transition between stages
geom_segment(aes(
x = x_start,
xend = x_end,
y = Midpoint-0.05,
yend = Midpoint-0.05),
arrow = arrow(length = unit(0.2, "cm"), type = "closed"),
color = "red") +
# Add descriptive labels showing the proportion applied
geom_text(aes(
x = as.numeric(Stages) - 0.5,
y = Midpoint,
label = Transition_Label),
color = "blue",
vjust = 1.2,
size = 3) +
scale_fill_brewer(palette = "Set3") +
labs(
title = "ATT Cascade",
x = "Stages",
y = "Proportion"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none"
)
GP
# Create the Cascade Plot
GP <- ggplot(tpt_cascade, aes(x = Stages, y = Cascade, fill = Stages)) +
geom_bar(stat = "identity", width = 0.6, color = "black") +
geom_text(aes(label = scales::percent(Cascade, accuracy = 0.1)), vjust = -0.5, size = 3) +
facet_wrap(~ assumption) +
# Add arrows to indicate transition between stages
geom_segment(aes(
x = x_start,
xend = x_end,
y = Midpoint-0.05,
yend = Midpoint-0.05),
arrow = arrow(length = unit(0.2, "cm"), type = "closed"),
color = "red") +
# Add descriptive labels showing the proportion applied
geom_text(aes(
x = as.numeric(Stages) - 0.5,
y = Midpoint,
label = Transition_Label),
color = "blue",
vjust = 1.2,
size = 3) +
scale_fill_brewer(palette = "Set3") +
labs(
title = "TPT Cascade",
x = "Cascade steps",
y = "Proportion"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none"
)
GP
fn1 <- glue(here('plots/TPT_cascadeTBD_labels')) + '.png'
ggsave(GP,file=fn1,w=10,h=5);
att_cascade_basecase <- fread(here('outdata/ATT_cascade.csv'))
att_cascade_noltfu <- fread(here('outdata/ATT_cascadenoltfu.csv'))
tpt_cascade_basecase <- fread(here('outdata/TPT_cascade.csv'))
tpt_cascade_noltfu <- fread(here('outdata/TPT_cascadenoltfu.csv'))
att_cascade_basecase$assumption <- 'basecase'
att_cascade_noltfu$assumption <- 'noltfu'
tpt_cascade_basecase$assumption <- 'basecase'
tpt_cascade_noltfu$assumption <- 'noltfu'
att_cascade <- rbind(att_cascade_basecase, att_cascade_noltfu)
tpt_cascade <- rbind(tpt_cascade_basecase, tpt_cascade_noltfu)
att_levels <- c('prop.tb.sympt.screen','prop.presumtive.tb', 'prop.prison.gp.assessment', 'prop.clinical.tb.suspicion',
'prop.attend.nhs.referral','prop.tb.diagnosed','prop.starting.att', 'prop.completing.att')
att_labels <- c('tb.sympt.screening','presumtive.tb', 'prison.gp.assessment', 'clinical.tb.suspicion',
'attend.nhs.referral','tb.diagnosis','starting.att', 'completing.att')
att_cascade <- att_cascade |>
mutate(Stages = factor(Stage, levels = paste0('int.', att_levels), labels = att_labels, ordered = TRUE)) |>
filter(tb=='TBD')
# Create the Cascade Plot
GP <- ggplot(att_cascade, aes(x = Stages, y = Cascade, fill = Stages)) +
geom_bar(stat = "identity", width = 0.6, color = "black") +
geom_text(aes(label = scales::percent(Cascade, accuracy = 0.1)), vjust = -0.5, size = 3) +
facet_wrap(~ assumption) +
scale_fill_brewer(palette = "Set3") +
labs(title = "ATT cascade ",
x = "Cascade steps",
y = "Proportion") +
# theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none")
GP
fn1 <- glue(here('plots/ATT_cascadeTBD')) + '.png'
ggsave(GP,file=fn1,w=6,h=5);
# more complex cascade plot
att_cascade <- att_cascade %>%
arrange(Stages) %>%
group_by(assumption) %>%
mutate(
# Create transition labels showing the proportion applied at each stage
Transition_Label = scales::percent(Cascade / lag(Cascade, default = first(Cascade)), accuracy = 1),
x_start = as.numeric(Stages) - 0.67,  # Start of the arrow (midpoint between stages)
x_end = as.numeric(Stages) - 0.35,    # End of the arrow (midpoint to next stage)
Midpoint = (Cascade + lag(Cascade, default = first(Cascade))) / 2  # Position for the label
)|>
mutate(Transition_Label = ifelse(grepl('screening', Stages), NA, Transition_Label),
x_start = ifelse(grepl('screening', Stages), NA, x_start),
x_end = ifelse(grepl('screening', Stages), NA, x_end))
# Create the Cascade Plot
GP <- ggplot(att_cascade, aes(x = Stages, y = Cascade, fill = Stages)) +
geom_bar(stat = "identity", width = 0.6, color = "black") +
geom_text(aes(label = scales::percent(Cascade, accuracy = 0.1)), vjust = -0.5, size = 2.5) +
facet_wrap(~ assumption) +
# Add arrows to indicate transition between stages
geom_segment(aes(
x = x_start,
xend = x_end,
y = Midpoint-0.15,
yend = Midpoint-0.15),
arrow = arrow(length = unit(0.2, "cm"), type = "closed"),
color = "red") +
# Add descriptive labels showing the proportion applied
geom_text(aes(
x = as.numeric(Stages) - 0.5,
y = Midpoint-0.1,
label = Transition_Label),
color = "blue",
vjust = 1.2,
size = 2.5) +
scale_fill_brewer(palette = "Set3") +
labs(
title = "ATT Cascade",
x = "Cascade steps",
y = "Proportion"
) +
# theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none"
)
GP
fn1 <- glue(here('plots/ATT_cascadeTBD_labels')) + '.png'
ggsave(GP,file=fn1,w=10,h=5);
# TPT
tpt_levels <- c('prop.tb.sympt.screen', 'prop.igra.tested', 'prop.igra.test.positive', 'prop.staying.o3.months',
'prop.attend.nhs.referral', 'prop.starting.tpt', 'prop.completing.tpt')
tpt_labels <- c('tb.sympt.screening', 'igra.tested', 'igra.test.positive', 'staying.o3.months',
'attend.nhs.referral', 'starting.tpt', 'completing.tpt')
tpt_cascade <- tpt_cascade |>
mutate(Stages = factor(Stage, levels = paste0('int.', tpt_levels), labels = tpt_labels, ordered = TRUE)) |>
filter(tb=='TBI')
GP <- ggplot(tpt_cascade, aes(x = Stages, y = Cascade, fill = Stages)) +
geom_bar(stat = "identity", width = 0.6, color = "black") +
geom_text(aes(label = scales::percent(Cascade, accuracy = 0.1)), vjust = -0.5, size = 3) +
facet_wrap(~ assumption) +
scale_fill_brewer(palette = "Set3") +
labs(title = "TPT cascadeTBI",
x = "Cascade steps",
y = "Proportion") +
# theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none")
GP
fn1 <- glue(here('plots/TPT_cascade')) + SA + '.png'
ggsave(GP,file=fn1,w=6,h=5);
# with labels
tpt_cascade <- tpt_cascade %>%
arrange(Stages) %>%
group_by(assumption) %>%
mutate(
# Create transition labels showing the proportion applied at each stage
Transition_Label = scales::percent(Cascade / lag(Cascade, default = first(Cascade)), accuracy = 1),
x_start = as.numeric(Stages) - 0.67,  # Start of the arrow (midpoint between stages)
x_end = as.numeric(Stages) - 0.35,    # End of the arrow (midpoint to next stage)
Midpoint = (Cascade + lag(Cascade, default = first(Cascade))) / 2  # Position for the label
)|>
mutate(Transition_Label = ifelse(grepl('screening', Stages), NA, Transition_Label),
x_start = ifelse(grepl('screening', Stages), NA, x_start),
x_end = ifelse(grepl('screening', Stages), NA, x_end))
# Create the Cascade Plot
GP <- ggplot(tpt_cascade, aes(x = Stages, y = Cascade, fill = Stages)) +
geom_bar(stat = "identity", width = 0.6, color = "black") +
geom_text(aes(label = scales::percent(Cascade, accuracy = 0.1)), vjust = -0.5, size = 3) +
facet_wrap(~ assumption) +
# Add arrows to indicate transition between stages
geom_segment(aes(
x = x_start,
xend = x_end,
y = Midpoint-0.05,
yend = Midpoint-0.05),
arrow = arrow(length = unit(0.2, "cm"), type = "closed"),
color = "red") +
# Add descriptive labels showing the proportion applied
geom_text(aes(
x = as.numeric(Stages) - 0.5,
y = Midpoint,
label = Transition_Label),
color = "blue",
vjust = 1.2,
size = 3) +
scale_fill_brewer(palette = "Set3") +
labs(
title = "TPT Cascade",
x = "Cascade steps",
y = "Proportion"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none"
)
GP
fn1 <- glue(here('plots/TPT_cascadeTBD_labels')) + '.png'
ggsave(GP,file=fn1,w=10,h=5);
# Create the Cascade Plot
GP <- ggplot(tpt_cascade, aes(x = Stages, y = Cascade, fill = Stages)) +
geom_bar(stat = "identity", width = 0.6, color = "black") +
geom_text(aes(label = scales::percent(Cascade, accuracy = 0.1)), vjust = -0.5, size = 3) +
facet_wrap(~ assumption) +
# Add arrows to indicate transition between stages
geom_segment(aes(
x = x_start,
xend = x_end,
y = Midpoint-0.05,
yend = Midpoint-0.05),
arrow = arrow(length = unit(0.2, "cm"), type = "closed"),
color = "red") +
# Add descriptive labels showing the proportion applied
geom_text(aes(
x = as.numeric(Stages) - 0.5,
y = Midpoint,
label = Transition_Label),
color = "blue",
vjust = 1.2,
size = 3) +
scale_fill_brewer(palette = "Set3") +
labs(
title = "TPT Cascade",
x = "Cascade steps",
y = "Proportion"
) +
# theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none"
)
GP
fn1 <- glue(here('plots/TPT_cascadeTBD_labels')) + '.png'
ggsave(GP,file=fn1,w=10,h=5);
# Create the Cascade Plot
GP <- ggplot(tpt_cascade, aes(x = Stages, y = Cascade, fill = Stages)) +
geom_bar(stat = "identity", width = 0.6, color = "black") +
geom_text(aes(label = scales::percent(Cascade, accuracy = 0.1)), vjust = -0.5, size = 2.5) +
facet_wrap(~ assumption) +
# Add arrows to indicate transition between stages
geom_segment(aes(
x = x_start,
xend = x_end,
y = Midpoint-0.05,
yend = Midpoint-0.05),
arrow = arrow(length = unit(0.2, "cm"), type = "closed"),
color = "red") +
# Add descriptive labels showing the proportion applied
geom_text(aes(
x = as.numeric(Stages) - 0.5,
y = Midpoint,
label = Transition_Label),
color = "blue",
vjust = 1.2,
size = 2.5) +
scale_fill_brewer(palette = "Set3") +
labs(
title = "TPT Cascade",
x = "Cascade steps",
y = "Proportion"
) +
# theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none"
)
GP
fn1 <- glue(here('plots/TPT_cascadeTBD_labels')) + '.png'
ggsave(GP,file=fn1,w=10,h=5);
fn1 <- glue(here('plots/TPT_cascadeTBI_labels')) + '.png'
ggsave(GP,file=fn1,w=10,h=5);
GP <- ggplot(tpt_cascade, aes(x = Stages, y = Cascade, fill = Stages)) +
geom_bar(stat = "identity", width = 0.6, color = "black") +
geom_text(aes(label = scales::percent(Cascade, accuracy = 0.1)), vjust = -0.5, size = 3) +
facet_wrap(~ assumption) +
scale_fill_brewer(palette = "Set3") +
labs(title = "TPT cascadeTBI",
x = "Cascade steps",
y = "Proportion") +
# theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none")
GP
fn1 <- glue(here('plots/TPT_cascadeTBI')) + '.png'
ggsave(GP,file=fn1,w=6,h=5);
